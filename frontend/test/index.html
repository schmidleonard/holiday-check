<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Hotel Backend Test-Frontend</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; }
    h2 { color: #003366; }
    label { display: block; margin-top: 1em; }
    input, button, select { margin-top: 0.2em; }
    .hotel-list { margin-top: 2em; }
    .hotel { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; }
    img { max-width: 120px; margin-right: 10px; }
  </style>
</head>
<body>
  <h2>Hotel Backend Test-Frontend</h2>

  <section>
    <h3>Neues Hotel anlegen</h3>
    <form id="createForm" enctype="multipart/form-data">
      <label>Name: <input name="name" required></label>
      <label>Kurzname: <input name="short_name" maxlength="10"></label>
      <label>Anzahl Zimmer: <input name="rooms" type="number" required></label>
      <label>Freie Zimmer: <input name="free_rooms" type="number" required></label>
      <label>Zimmerpreis: <input name="room_price" type="number"></label>
      <label>Bilder (max. 4): <input name="photos" type="file" accept="image/*" multiple></label>
      <button type="submit">Hotel anlegen</button>
    </form>
  </section>

  <section class="hotel-list">
    <h3>Hotels</h3>
    <button onclick="fetchHotels()">Aktualisieren</button>
    <div id="hotels"></div>
  </section>

  <script>
    const API = "http://localhost:3000"; // ggf. Port anpassen

    async function fetchHotels() {
      const res = await fetch(API + "/hotel");
      const hotels = await res.json();
      const hotelsDiv = document.getElementById("hotels");
      hotelsDiv.innerHTML = "";
      (hotels || []).forEach(hotel => {
        const div = document.createElement("div");
        div.className = "hotel";
        div.innerHTML = `
          <b>${hotel.name}</b> (${hotel.short_name || ""})<br>
          Zimmer: ${hotel.rooms} | Frei: ${hotel.free_rooms} | Preis: ${hotel.room_price || "-"}<br>
          ${[hotel.picture_one, hotel.picture_two, hotel.picture_three, hotel.picture_four].filter(Boolean).map(pic => `<img src="${API}/${pic.replace(/\\/g, "/")}" alt="Bild">`).join("")}
          <br>
          <button onclick="deleteHotel('${hotel._id}')">Löschen</button>
          <button onclick="showUpdateForm('${hotel.name}')">Bearbeiten</button>
          <div id="update-${hotel.name}" style="display:none;"></div>
        `;
        hotelsDiv.appendChild(div);
      });
    }

    document.getElementById("createForm").onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const res = await fetch(API + "/hotel", {
        method: "POST",
        body: formData
      });
      if (res.ok) {
        alert("Hotel angelegt!");
        form.reset();
        fetchHotels();
      } else {
        alert("Fehler beim Anlegen!");
      }
    };

    async function deleteHotel(id) {
      if (!confirm("Wirklich löschen?")) return;
      const res = await fetch(API + "/hotel/" + id, { method: "DELETE" });
      if (res.ok) {
        fetchHotels();
      } else {
        alert("Fehler beim Löschen!");
      }
    }

    function showUpdateForm(name) {
      const div = document.getElementById("update-" + name);
      div.style.display = "block";
      div.innerHTML = `
        <form onsubmit="updateHotel(event, '${name}')">
          <label>Freie Zimmer: <input name="free_rooms" type="number"></label>
          <label>Zimmerpreis: <input name="room_price" type="number"></label>
          <button type="submit">Aktualisieren</button>
        </form>
      `;
    }

    async function updateHotel(e, name) {
      e.preventDefault();
      const form = e.target;
      const data = {};
      Array.from(form.elements).forEach(el => {
        if (el.name && el.value) data[el.name] = el.value;
      });
      const res = await fetch(API + "/hotel/" + name, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      if (res.ok) {
        alert("Hotel aktualisiert!");
        fetchHotels();
      } else {
        alert("Fehler beim Aktualisieren!");
      }
    }

    fetchHotels();
  </script>
</body>
</html>
