<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flight Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h1 class="mb-4">Flight Manager</h1>

    <div class="mb-3">
      <button class="btn btn-primary" onclick="getAllFlights()">Alle Flüge laden</button>
    </div>

    <div class="mb-3">
      <input type="text" id="searchDestination" class="form-control" placeholder="Ziel eingeben">
      <button class="btn btn-secondary mt-2" onclick="searchFlights()">Nach Ziel suchen</button>
    </div>

    <h4>Flug hinzufügen</h4>
    <form id="flightForm" onsubmit="addFlight(event)">
      <div class="row">
        <div class="col-md-4">
          <input class="form-control mb-2" placeholder="Abflug" id="departure" required>
          <input class="form-control mb-2" placeholder="Ziel" id="destination" required>
          <input class="form-control mb-2" placeholder="Flugzeug" id="aircraft">
        </div>
        <div class="col-md-4">
          <input class="form-control mb-2" placeholder="Fluggesellschaft" id="airline" required>
          <input type="datetime-local" class="form-control mb-2" id="departure_time">
          <input type="datetime-local" class="form-control mb-2" id="sheduled_time" required>
        </div>
        <div class="col-md-4">
          <input type="number" class="form-control mb-2" placeholder="Preis (€)" id="price" required>
          <input type="number" class="form-control mb-2" placeholder="Verfügbare Plätze" id="available_seats">
        </div>
      </div>
      <button class="btn btn-success mt-2" type="submit">Flug hinzufügen</button>
    </form>

    <h4 class="mt-5">Alle Flüge</h4>
    <ul id="flightList" class="list-group mt-2"></ul>
  </div>

  <script>
    const apiUrl = "http://localhost:3002/flight"; // Passe ggf. den Port an

    async function getAllFlights() {
      const res = await fetch(apiUrl);
      const data = await res.json();
      displayFlights(data);
    }

    async function searchFlights() {
      const dest = document.getElementById("searchDestination").value;
      if (!dest) return;
      const res = await fetch(`${apiUrl}/${dest}`);
      const data = await res.json();
      displayFlights(data);
    }

    async function addFlight(event) {
      event.preventDefault();
      const flight = {
        departure: document.getElementById("departure").value,
        destination: document.getElementById("destination").value,
        aircraft: document.getElementById("aircraft").value,
        airline: document.getElementById("airline").value,
        departure_time: document.getElementById("departure_time").value,
        sheduled_time: document.getElementById("sheduled_time").value,
        price: parseFloat(document.getElementById("price").value),
        available_seats: parseInt(document.getElementById("available_seats").value)
      };

      const res = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(flight)
      });

      const newFlight = await res.json();
      alert("Flug hinzugefügt!");
      getAllFlights();
      document.getElementById("flightForm").reset();
    }

    async function deleteFlight(id) {
      if (!confirm("Diesen Flug wirklich löschen?")) return;
      await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
      getAllFlights();
    }

    function displayFlights(flights) {
      const list = document.getElementById("flightList");
      list.innerHTML = "";
      if (!flights.length) {
        list.innerHTML = "<li class='list-group-item'>Keine Flüge gefunden.</li>";
        return;
      }

      flights.forEach(f => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <div>
            <strong>${f.departure} ➜ ${f.destination}</strong> (${f.airline})<br>
            ${new Date(f.sheduled_time).toLocaleString()} – ${f.price}€
          </div>
          <button class="btn btn-danger btn-sm" onclick="deleteFlight('${f._id}')">Löschen</button>
        `;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
